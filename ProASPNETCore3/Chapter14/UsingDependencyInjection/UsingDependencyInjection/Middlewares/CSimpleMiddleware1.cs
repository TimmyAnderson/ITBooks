using Microsoft.AspNetCore.Http;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using UsingDependencyInjection.Service;
//----------------------------------------------------------------------------------------------------------------------
namespace UsingDependencyInjection.Middlewares
{
//----------------------------------------------------------------------------------------------------------------------
	public sealed class CSimpleMiddleware1
	{
//----------------------------------------------------------------------------------------------------------------------
		private readonly RequestDelegate						MNextMiddleware;
		private readonly ITextService2							MTextService2;
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
		// !!! MIDDLEWARES mozu pouzivat DEPENDENCY INJECTION.
		public CSimpleMiddleware1(RequestDelegate NextMiddleware, ITextService2 TextService2)
		{
			MNextMiddleware=NextMiddleware;
			MTextService2=TextService2;
		}
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
		public async Task Invoke(HttpContext Context)
		{
			if (Context.Request.Path=="/EndpointMiddleware2")
			{
				await Context.Response.WriteAsync($"MESSAGE form SERVICE [{MTextService2.GetText()}] !");
			}
			else
			{
				await MNextMiddleware(Context);
			}
		}
//----------------------------------------------------------------------------------------------------------------------
	}
//----------------------------------------------------------------------------------------------------------------------
}
//----------------------------------------------------------------------------------------------------------------------