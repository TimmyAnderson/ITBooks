using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
//-------------------------------------------------------------------------------------------------------
namespace Exception
{
//-------------------------------------------------------------------------------------------------------
	class Program
	{
//-------------------------------------------------------------------------------------------------------
        private static CDBWrapper								MDB;
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
        private static void ThreadProc()
        {
            try
            {
                Monitor.Enter(MDB);

                Call3rdPartyCode(null);

                Monitor.Exit(MDB);
            }
            catch
            {
                Console.WriteLine("3rd party code threw an exception !");
            }
        }
//-------------------------------------------------------------------------------------------------------
        private static void Call3rdPartyCode(Object Obj)
        {
            if (Obj==null)
                throw(new NullReferenceException());

            // Do some work.
        }
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		static void Main(string[] args)
		{
            MDB=new CDBWrapper("DB");

            Thread			NewThread = new Thread(ThreadProc);

            NewThread.Start();

            Thread.Sleep(500);

            Console.WriteLine("Acquiring lock !");

            Monitor.Enter(MDB);
            
            // Do some work.

            Console.WriteLine("Releasing lock !");

            Monitor.Exit(MDB);
		}
//-------------------------------------------------------------------------------------------------------
	}
//-------------------------------------------------------------------------------------------------------
}
//-------------------------------------------------------------------------------------------------------