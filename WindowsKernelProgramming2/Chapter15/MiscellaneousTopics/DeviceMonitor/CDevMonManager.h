//----------------------------------------------------------------------------------------------------------------------
#pragma once
//----------------------------------------------------------------------------------------------------------------------
#include <ntddk.h>
#include "Helpers\CFastMutexGlobal.h"
#include "SMonitoredDevice.h"
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
constexpr int													MAX_MONITORED_DEVICES=32;
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
class CDevMonManager final
{
//----------------------------------------------------------------------------------------------------------------------
	private:
		SMonitoredDevice										MDevices[MAX_MONITORED_DEVICES];
		int														MMonitoredDeviceCount;
		CFastMutexGlobal										MLock;
		PDRIVER_OBJECT											MDriverObject;
		PDEVICE_OBJECT											MFilterDeviceObject;

	private:
		bool RemoveDevice(int Index);

	public:
		const PDEVICE_OBJECT GetFilterDeviceObject(void) const;
		void SetFilterDeviceObject(PDEVICE_OBJECT FilterDeviceObject);

	public:
		void Init(PDRIVER_OBJECT DriverObject);
		NTSTATUS AddDevice(PCWSTR Name);
		int FindDevice(PCWSTR Name) const;
		bool RemoveDevice(PCWSTR Name);
		void RemoveAllDevices(void);
//----------------------------------------------------------------------------------------------------------------------
};
//----------------------------------------------------------------------------------------------------------------------