using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
//------------------------------------------------------------------------------
namespace ISupportsCancelationTest
{
//------------------------------------------------------------------------------
	public class CMyThread : ISupportsCancellation
	{
//------------------------------------------------------------------------------
		private AutoResetEvent				MEvent=new AutoResetEvent(false);
		private bool						MWasCancelled=false;
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
		public bool							IsCanceled
		{
			get
			{
				return(MWasCancelled);
			}
		}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
		private void MyThread()
		{
			for (int i=0;i<10;i++)
			{
				Console.WriteLine("Waiting...");

				if (MEvent.WaitOne(1000)==true)
				{
					MWasCancelled=true;
					Console.WriteLine("Thread WAS canceled !");
					break;
				}
			}
		}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
		public void Run()
		{
			Thread			T=new Thread(MyThread);

			T.Start();
		}
//------------------------------------------------------------------------------
		public void Cancel()
		{
			Console.WriteLine("Thread WILL BE canceled !");
			MEvent.Set();
		}
//------------------------------------------------------------------------------
	}
//------------------------------------------------------------------------------
}
//------------------------------------------------------------------------------