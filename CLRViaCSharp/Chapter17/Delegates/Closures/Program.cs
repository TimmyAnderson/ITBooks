using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;
//-------------------------------------------------------------------------------------------------------
namespace Closures
{
//-------------------------------------------------------------------------------------------------------
	class Program
	{
//-------------------------------------------------------------------------------------------------------
		// !!!!! Tuto triedu generuje C# z deklaracie CLOSURE.
		/*
		[CompilerGenerated]
		private sealed class <>c__DisplayClass1
		{
//-------------------------------------------------------------------------------------------------------
			// Fields.
			public int											LocalVariable;
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
			// Constructor.
			public <>c__DisplayClass1()
			{

			}
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
			// Methods.
			public int <ReturnClosure>b__0(int P)
			{
				return(P + this.LocalVariable);
			}
//-------------------------------------------------------------------------------------------------------
		}
		*/
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		private static Func<int,int> ReturnClosure()
		{
			int													LocalVariable=10;

			// Toto je CLOSURE, lebo sa odkazuje na LocalVariable.
			// !!!!! Pri deklaracii CLOSURE C# kompilator generuje TRIEDU, ktora ako MEMBER bude obsahovat LocalVariable a bude mat metodu, ktora vykona kod LAMBDA EXPRESSION (P+LocalVariable). Preto NESKORSIA ZMENA LocalVariable sa PREMIETNE do zmeny kodu.
			// !!!!! V skutocnosti C# generuje kod, kde VYTVORI INSTANCIU <>c__DisplayClass1 a do Func<int,int> priradi metodu DELEGATE na <ReturnClosure>b__0(int P).
			Func<int,int>										Closure=P => P+LocalVariable;

			// !!! Aj ked zmenim hodnotu, tak je v Closure tato zmena REFLEKTOVANA.
			LocalVariable=100;

			return(Closure);
		}
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		private static void Test()
		{
			Func<int,int>										Method=ReturnClosure();
			int													ReturnValue=Method(12);

			Console.WriteLine(string.Format("ReturnValue: [{0}] !",ReturnValue));
		}
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		static void Main(string[] args)
		{
			Test();

			Console.WriteLine("\nPress any key to EXIT !");
			Console.ReadLine();
		}
//-------------------------------------------------------------------------------------------------------
	}
//-------------------------------------------------------------------------------------------------------
}
//-------------------------------------------------------------------------------------------------------