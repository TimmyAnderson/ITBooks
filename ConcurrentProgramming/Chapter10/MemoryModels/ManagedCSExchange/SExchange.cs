using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
//------------------------------------------------------------------------------
namespace ManagedCSExchange
{
//------------------------------------------------------------------------------
	// !!! Pouzivam 'struct', kvoli vykonnosti ako aj zabrazneniu pouzitia GC nad SExchange.
	public struct SExchange
	{
//------------------------------------------------------------------------------
		private volatile int				MTaken;
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
		public void EnterCS()
		{
			while (Interlocked.Exchange(ref MTaken, 1)!=0)
			{
				Console.WriteLine("LOCK WAITING...");

				// Aby som nezabil CPU v cykle.
				Thread.Sleep(100);
			}
		}
//------------------------------------------------------------------------------
		public void ExitCS()
		{
			MTaken=0;
		}
//------------------------------------------------------------------------------
	}
//------------------------------------------------------------------------------
}
//------------------------------------------------------------------------------