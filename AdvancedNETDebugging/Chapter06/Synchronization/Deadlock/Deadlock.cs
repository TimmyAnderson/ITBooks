using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
//-------------------------------------------------------------------------------------------------------
namespace Deadlock
{
//-------------------------------------------------------------------------------------------------------
	class Deadlock
	{
//-------------------------------------------------------------------------------------------------------
        private static CDBWrapper1								MDB1;
        private static CDBWrapper2								MDB2;
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
        private static void ThreadProc()
        {
            Console.WriteLine("Start worker thread !");

            lock (MDB1)
            {
                Console.WriteLine("Updating DB1 !");

                Thread.Sleep(3000);

                lock (MDB2)
                {
                    Console.WriteLine("Updating DB2 !");
                }
            }

            Console.WriteLine("Finish worker thread !");
        }
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		static void Main(string[] args)
		{
            MDB1=new CDBWrapper1("DBCon1");
            MDB2=new CDBWrapper2("DBCon2");

            Thread			NewThread=new Thread(ThreadProc);

            NewThread.Start();

            Thread.Sleep(2000);

            lock (MDB2)
            {
                Console.WriteLine("Updating DB2 !");

                Thread.Sleep(2000);

                lock (MDB1)
                {
                    Console.WriteLine("Updating DB1 !");
                }
            }
		}
//-------------------------------------------------------------------------------------------------------
	}
//-------------------------------------------------------------------------------------------------------
}
//-------------------------------------------------------------------------------------------------------