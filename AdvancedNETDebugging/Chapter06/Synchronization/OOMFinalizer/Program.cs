using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
//-------------------------------------------------------------------------------------------------------
namespace OOMFinalizer
{
//-------------------------------------------------------------------------------------------------------
    class OOMFinalizer
    {
//-------------------------------------------------------------------------------------------------------
        private CWorker											MWorker; 
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
        private void Initialize()
        {
            byte[]			B=new byte[100];

            MWorker=new CWorker();
            MWorker.ProcessData(B);

            MWorker=null;

			// Spustim GC.
            GC.Collect();
        }
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
        public void Run(int Iterations)
        {
            Initialize();

            for (int i=0;i<Iterations;i++)
            {
                byte[]		B=new byte[10000];
                WMI			W=new WMI(B);

                W.ProcessData();
            }

			// Spustim GC.
            GC.Collect();
           
            Console.WriteLine("Press any key to exit !");
            Console.ReadKey();
        }
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
        static void Main(string[] Args)
        {
            if (Args.Length<1)
            {
                Console.WriteLine("OOMFinalizer.exe <num iterations>");
                return;
            }

            OOMFinalizer	O=new OOMFinalizer();

            O.Run(int.Parse(Args[0]));
        }
//-------------------------------------------------------------------------------------------------------
    }
//-------------------------------------------------------------------------------------------------------
}
//-------------------------------------------------------------------------------------------------------