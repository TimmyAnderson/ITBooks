using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;
//-------------------------------------------------------------------------------------------------------
namespace Heap
{
//-------------------------------------------------------------------------------------------------------
	class Heap
	{
//-------------------------------------------------------------------------------------------------------
        [DllImport("MyNative.dll")]
        static extern void InitBuffer(byte[] Buffer, int Size); 
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
        public void Run()
        {
            byte[]				B=new byte[50];

            for (int i=0;i<50;i++)
                B[i]=15;


            Console.WriteLine("Press any key to invoke native method !");
            Console.ReadKey();

			// Sposobi HEAP corruption, pretoze NATIVE CODE inicializuje az 255 items, aj ked pole ma iba 50 items.
            InitBuffer(B, 50);
            
            Console.WriteLine("Press any key to exit !");
            Console.ReadKey();
        }
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		static void Main(string[] args)
		{
            Heap			H=new Heap();

            H.Run();
		}
//-------------------------------------------------------------------------------------------------------
	}
//-------------------------------------------------------------------------------------------------------
}
//-------------------------------------------------------------------------------------------------------