using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
//-------------------------------------------------------------------------------------------------------
namespace Events
{
//-------------------------------------------------------------------------------------------------------
	public class CBaseClassWithEvents
	{
//-------------------------------------------------------------------------------------------------------
		protected readonly object								MLock=new object();
//-------------------------------------------------------------------------------------------------------
		protected EventHandler									MVirtualEvent;
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		// !!! EVENT je VIRTUAL EVENT.
		public virtual event EventHandler						VirtualEvent
		{
			add
			{
				Console.WriteLine("METHOD CBaseClassWithEvents.add_VirtualEvent() CALLED !");

				lock(MLock)
				{
					MVirtualEvent+=value;
				}
			}
			remove
			{
				Console.WriteLine("METHOD CBaseClassWithEvents.remove_VirtualEvent() CALLED !");

				lock(MLock)
				{
					MVirtualEvent-=value;
				}
			}
		}
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		protected void OnFireEvent(EventArgs Argument)
		{
			EventHandler										Temp;

			lock(MLock)
			{
				Temp=MVirtualEvent;
			}

			if (Temp!=null)
			{
				Temp(this,Argument);
			}
		}
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------
		public void SimulateEvent()
		{
			OnFireEvent(EventArgs.Empty);
		}
//-------------------------------------------------------------------------------------------------------
	}
//-------------------------------------------------------------------------------------------------------
}
//-------------------------------------------------------------------------------------------------------